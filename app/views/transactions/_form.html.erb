<div class="card">
  <div class="card-body bg-base-100">
    <%= render "shared/form_errors", errors: transaction.errors.full_messages %>

    <%= simple_form_for transaction, html: {data: {controller: "transaction-form"}, class: "card"} do |f| %>
      <%= f.input :sender_id,
              collection:
                [Bank.ves_default].map { |bank| [bank.display_name, bank.id] },
              prompt: t("select_bank") %>

      <%= f.input :receiver_id,
              collection:
                Customer.all.map { |customer| [customer.name, customer.id] },
              prompt: t("select_customer"),
              input_html: {
                data: {
                  action: "auto-submit#submit",
                },
              } %>

      <%= f.association :bank_balances,
                    as: :check_boxes,
                    collection: sender.bank_balances.order("id DESC"),
                    label_method: :display_name,
                    value_method: :id,
                    input_html: {
                      class: "checkbox checkbox-primary",
                    },
                    item_wrapper_class: "label cursor-pointer justify-start gap-2" %>

      <div>
        <%= f.hidden_field :sender_type, value: "Bank" %>
        <%= f.hidden_field :receiver_type, value: "Customer" %>
        <%= f.hidden_field :target_currency,
                       value: f.object.target_currency || current_exchange_rate.target %>

        <%= f.hidden_field :source_currency,
                       value: f.object.source_currency || current_exchange_rate.source %>
      </div>

      <fieldset class="fieldset">
        <legend class="fieldset-legend"><%= f.object.class.human_attribute_name(:amount) %></legend>
        <div class="input w-full">
          <%= dollar_sign %>
          <%= f.text_field :amount,
                       value: money_as_value(transaction.send(:amount)),
                       class: "grow",
                       placeholder: "0.00",
                       data: {
                         transaction_form_target: "amount",
                         controller: "number-input",
                         action: "transaction-form#calculate",
                       } %>
          <span class="w-8">
            <%= render_currency_flag(current_exchange_rate.source) %>
          </span>

        </div>
      </fieldset>

      <fieldset class="fieldset">
        <legend class="fieldset-legend"><%= Transaction.human_attribute_name(:total) %></legend>
        <div class="input w-full">
          <%= dollar_sign %>
          <%= f.text_field :total,
                       value: money_as_value(f.object.total),
                       class: "grow",
                       readonly: true,
                       data: {
                         transaction_form_target: "total",
                         controller: "number-input",
                       } %>

          <span class="w-8">
            <%= render_currency_flag(current_exchange_rate.target) %>
          </span>
        </div>
      </fieldset>

      <%= render "summary", form: f %>

      <div class="card-actions justify-end mt-4">
        <%= turbo_submit(f) %>
      </div>
    <% end %>

  </div>
</div>
